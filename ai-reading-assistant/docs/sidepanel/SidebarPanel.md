# SidePanel Component

## ğŸ“‹ ç»„ä»¶æ¦‚è¿°

**ä½ç½®**: `src/sidepanel/SidebarPanel.tsx`
**ç”¨é€”**: ä¸»ä¾§è¾¹æ èŠå¤©ç•Œé¢ï¼ŒåŒ…å«èŠå¤©åŠŸèƒ½ã€è®¾ç½®é¡µé¢åˆ‡æ¢å’Œæˆªå›¾åŠŸèƒ½é›†æˆ
**ä¸»è¦åŠŸèƒ½**:
- èŠå¤©ç•Œé¢ç®¡ç†
- AIæ¶ˆæ¯æ¸²æŸ“
- ä¸Šä¸‹æ–‡æ˜¾ç¤ºï¼ˆé€‰ä¸­æ–‡æœ¬ã€æˆªå›¾ï¼‰
- APIæä¾›å•†åˆ‡æ¢
- æˆªå›¾æ¨¡å¼åˆ‡æ¢

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. èŠå¤©ç•Œé¢ç®¡ç†

**çŠ¶æ€ç®¡ç†**:
- `currentView`: æ§åˆ¶å½“å‰æ˜¾ç¤ºçš„è§†å›¾ï¼ˆ'chat' æˆ– 'settings'ï¼‰
- `isSidebarOpen`: ä¾§è¾¹æ æ˜¯å¦æ‰“å¼€
- `messages`: èŠå¤©æ¶ˆæ¯å†å²
- `userInput`: ç”¨æˆ·è¾“å…¥æ¡†å†…å®¹
- `isTyping`: AIæ­£åœ¨æ‰“å­—çŠ¶æ€
- `isScreenshotMode`: æˆªå›¾æ¨¡å¼å¼€å…³

**ä¸»è¦å‡½æ•°**:
- `handleSendMessage()`: å‘é€ç”¨æˆ·æ¶ˆæ¯åˆ°AI
- `handleKeyPress()`: å¤„ç†é”®ç›˜äº‹ä»¶ï¼ˆEnterå‘é€ï¼ŒEscapeå–æ¶ˆç­‰ï¼‰
- `handleToggleScreenshot()`: åˆ‡æ¢æˆªå›¾/èŠå¤©æ¨¡å¼
- `handleClose()`: å…³é—­ä¾§è¾¹æ 
- `handleSettingsClick()`: æ‰“å¼€è®¾ç½®é¡µé¢

### 2. AIæ¶ˆæ¯æ¸²æŸ“

**æ¶ˆæ¯ç»“æ„**:
```typescript
interface Message {
  id: string
  role: 'user' | 'assistant'
  content: string
  timestamp: string
}
```

**æ¶ˆæ¯æ˜¾ç¤º**:
- ç”¨æˆ·æ¶ˆæ¯ï¼šå³ä¾§å¯¹é½ï¼ŒPrimaryèƒŒæ™¯è‰²ï¼ˆ#6750A4ï¼‰
- AIæ¶ˆæ¯ï¼šå·¦ä¾§å¯¹é½ï¼ŒSurface ContainerèƒŒæ™¯è‰²ï¼ˆ#F3EDF7ï¼‰
- åŒ…å«æ—¶é—´æˆ³æ˜¾ç¤º
- æ”¯æŒMarkdownå†…å®¹çš„æ¸²æŸ“

### 3. ä¸Šä¸‹æ–‡æ˜¾ç¤º

**æ˜¾ç¤ºåœºæ™¯**:

#### A. é€‰ä¸­æ–‡æœ¬ä¸Šä¸‹æ–‡
- æ˜¾ç¤ºåœ¨èŠå¤©ç•Œé¢é¡¶éƒ¨
- æ˜¾ç¤ºé€‰ä¸­æ–‡æœ¬é¢„è§ˆï¼ˆå‰100å­—ç¬¦ï¼Œè¶…å‡ºæ˜¾ç¤º"..."ï¼‰
- èƒŒæ™¯è‰²ï¼šç´«è‰²èƒŒæ™¯å¡ç‰‡ï¼Œå¸¦å·¦ä¾§ç´«è‰²è¾¹æ¡†æ ‡è¯†
- åŒ…å«"Selected Context"æ ‡ç­¾å’Œå°ºå¯¸ä¿¡æ¯

#### B. æˆªå›¾ä¸Šä¸‹æ–‡
- æ˜¾ç¤ºåœ¨èŠå¤©ç•Œé¢é¡¶éƒ¨
- æ˜¾ç¤ºæˆªå›¾å°ºå¯¸ï¼š`width Ã— height`
- èƒŒæ™¯è‰²ï¼šç´«è‰²èƒŒæ™¯å¡ç‰‡ï¼Œå¸¦å·¦ä¾§ç´«è‰²è¾¹æ¡†æ ‡è¯†
- åŒ…å«"Screenshot Captured"æ ‡ç­¾
- å¯ç‚¹å‡»æŸ¥çœ‹æˆ–é‡æ–°æˆªå›¾

#### C. å†å²æ¶ˆæ¯
- æ”¯æŒå¤šæ¡å¯¹è¯å†å²
- æŒ‰æ—¶é—´å€’åºæ’åˆ—
- æ¯æ¡æ¶ˆæ¯åŒ…å«å‘é€è€…ã€å†…å®¹ã€æ—¶é—´æˆ³
- ç”¨æˆ·æ¶ˆæ¯å’ŒAIæ¶ˆæ¯æœ‰ä¸åŒçš„èƒŒæ™¯è‰²å’Œå¯¹é½æ–¹å¼

### 4. è®¾ç½®é¡µé¢é›†æˆ

**è®¾ç½®æŒ‰é’®**:
- å³ä¸Šè§’ï¼šSettingså›¾æ ‡ï¼ˆé½¿è½®ï¼‰
- å·¦ä¸Šè§’ï¼šScreenshotå›¾æ ‡ï¼ˆç›¸æœºï¼‰
- ç‚¹å‡»Settingså›¾æ ‡åˆ‡æ¢åˆ°è®¾ç½®è§†å›¾
- ç‚¹å‡»Screenshotå›¾æ ‡å¼€å¯æˆªå›¾æ¨¡å¼

**è®¾ç½®é¡µé¢åŠŸèƒ½**:
- APIæä¾›å•†é€‰æ‹©ï¼ˆOpenAI/Anthropic/Customï¼‰
- API Keyè¾“å…¥ä¸éªŒè¯
- è¿æ¥æµ‹è¯•æŒ‰é’®
- Base URLé…ç½®ï¼ˆCustom APIï¼‰
- URLç™½åå•ç®¡ç†
- éšç§ä¿æŠ¤æç¤º

**çŠ¶æ€åˆ‡æ¢**:
- ä»èŠå¤©ç•Œé¢åˆ‡æ¢åˆ°è®¾ç½®é¡µé¢
- ä»è®¾ç½®é¡µé¢åˆ‡æ¢å›èŠå¤©ç•Œé¢
- åœ¨è®¾ç½®é¡µé¢ä¿æŒèŠå¤©ç•Œé¢çŠ¶æ€

---

## ğŸ”§ æŠ€æœ¯å®ç°

### Hooksä½¿ç”¨

```typescript
const { settings } = useSettings()
const { addMessage } = useMessages()
```

### æ¶ˆæ¯é€šä¿¡

**äº‹ä»¶ç±»å‹**:
- `'selection-text'`: æ¥æ”¶é€‰ä¸­çš„æ–‡æœ¬
- `'screenshot-captured'`: æ¥æ”¶æˆªå›¾æ•°æ®
- `'side-panel-toggle'`: æ§åˆ¶ä¾§è¾¹æ å¼€å…³
- `'show-settings'`: æ˜¾ç¤ºè®¾ç½®é¡µé¢

**æ•°æ®ä¼ é€’**:
```typescript
const contextData: EnhancedContextData = {
  url: window.location.href,
  selectedText: initialContext,
  screenshot: contextScreenshot,
  query: userInput
}
```

### APIé›†æˆ

**æ”¯æŒæä¾›å•†**:
- âœ… OpenAI (GPT-3.5-Turbo)
- âœ… Anthropic (Claude-3-Haiku)
- âœ… Custom (è‡ªå®šä¹‰ç«¯ç‚¹)

**APIè°ƒç”¨ç¤ºä¾‹**:
```typescript
// OpenAIç¤ºä¾‹
response = await fetch('https://api.openai.com/v1/chat/completions', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${settings.apiKey}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    model: 'gpt-3.5-turbo',
    messages: [
      { role: 'system' as const, content: systemPrompt },
      { role: 'user' as const, content: userInput }
    ],
    max_tokens: 1000,
    temperature: 0.7
  })
})

// Anthropicç¤ºä¾‹
response = await fetch('https://api.anthropic.com/v1/messages', {
  method: 'POST',
  headers: {
    'x-api-key': settings.apiKey,
    'Content-Type': 'application/json',
    'anthropic-version': '2023-06-01'
  },
  body: JSON.stringify({
    model: 'claude-3-haiku-20240307',
    max_tokens: 1000,
    messages: [
      { role: 'user' as const, content: systemPrompt + '\n\n' + userInput }
    ]
  })
})
```

---

## ğŸ¨ UIè®¾è®¡ç‰¹ç‚¹

### Material Design 3 åº”ç”¨

**è®¾è®¡åŸåˆ™**:
- **Helpful**: æä¾›ç›´è§‚çš„å¸®åŠ©åŠŸèƒ½
- **Organic**: è‡ªç„¶çš„äº¤äº’å’ŒåŠ¨ç”»
- **Rhythm**: ä¸€è‡´çš„è§†è§‰èŠ‚å¥å’Œé—´è·
- **Focus**: æ¸…æ™°çš„ä¿¡æ¯å±‚æ¬¡å’Œé‡ç‚¹

**é¢œè‰²ä½¿ç”¨**:
- `--md3-primary`: #6750A4ï¼ˆä¸»è¦æ“ä½œè‰²ï¼‰
- `--md3-surface-container`: #F3EDF7ï¼ˆèƒŒæ™¯è‰²ï¼‰
- `--md3-on-surface`: #1D1B20ï¼ˆæ–‡å­—è‰²ï¼‰
- `--md3-on-surface-variant`: #49454Fï¼ˆè¾…åŠ©æ–‡å­—è‰²ï¼‰

**åœ†è§’ç­–ç•¥**:
- ä¾§è¾¹æ å®¹å™¨ï¼š`rounded-l-[24px]`ï¼ˆå·¦ä¸Šè§’å¤§åœ†è§’ï¼‰
- å†…éƒ¨å¡ç‰‡ï¼š`rounded-[16px]`ï¼ˆæ ‡å‡†åœ†è§’ï¼‰
- æŒ‰é’®ï¼š`rounded-full`ï¼ˆè¯ä¸¸å½¢çŠ¶ï¼‰

**åŠ¨ç”»æ•ˆæœ**:
- æ‰“å­—æœºæ•ˆæœï¼š`animate-bounce`ï¼ˆ3ä¸ªåœ†ç‚¹è·³åŠ¨ï¼‰
- å¹³æ»‘è¿‡æ¸¡ï¼š`transition-all duration-200`
- æµå…¥/æ»‘å‡ºï¼š`animate-slide-up` / `animate-slide-down`

---

## ğŸ“ ä¾èµ–é¡¹

**React Hooks**:
- `useState`: ç»„ä»¶çŠ¶æ€ç®¡ç†
- `useEffect`: å‰¯ä½œç”¨å’Œæ¸…ç†
- `useCallback`: æ€§èƒ½ä¼˜åŒ–

**è‡ªå®šä¹‰Hooks**:
- `useSettings()`: è®¿é—®è®¾ç½®çŠ¶æ€
- `useMessages()`: è®¿é—®æ¶ˆæ¯å†å²
- `useConnection()`: è®¿é—®è¿æ¥çŠ¶æ€

**ç±»å‹å®šä¹‰**:
- `Settings`: APIé…ç½®ç±»å‹
- `Message`: æ¶ˆæ¯ç±»å‹
- `ConnectionStatus`: è¿æ¥çŠ¶æ€
- `EnhancedContextData`: å¢å¼ºçš„ä¸Šä¸‹æ–‡æ•°æ®ç±»å‹

---

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€èŠå¤©
1. ç”¨æˆ·åœ¨è¾“å…¥æ¡†è¾“å…¥é—®é¢˜
2. ç‚¹å‡»SendæŒ‰é’®æˆ–æŒ‰Enteré”®å‘é€
3. AIè¿”å›å“åº”å¹¶æ˜¾ç¤ºåœ¨èŠå¤©ç•Œé¢
4. æ¶ˆæ¯å¸¦æ—¶é—´æˆ³å’Œç”¨æˆ·/å‘é€è€…æ ‡è¯†

### åˆ‡æ¢åˆ°è®¾ç½®
1. ç‚¹å‡»å³ä¸Šè§’Settingså›¾æ ‡
2. åœ¨è®¾ç½®é¡µé¢å¯ä»¥é…ç½®API Keyç­‰
3. ç‚¹å‡»èŠå¤©ç•Œé¢åŒºåŸŸæˆ–CloseæŒ‰é’®è¿”å›èŠå¤©

### æˆªå›¾åŠŸèƒ½
1. ç‚¹å‡»å³ä¸Šè§’Screenshotå›¾æ ‡è¿›å…¥æˆªå›¾æ¨¡å¼
2. èŠå¤©ç•Œé¢è¢«é»‘è‰²åŠé€æ˜å±‚è¦†ç›–
3. æ‹–æ‹½é€‰æ‹©è£å‰ªåŒºåŸŸ
4. æŒ‰Enterç¡®è®¤æ•è·ï¼ŒæŒ‰Escapeå–æ¶ˆ
5. æˆªå›¾åè‡ªåŠ¨è¿”å›èŠå¤©æ¨¡å¼ï¼Œæˆªå›¾æ•°æ®ä¼šæ˜¾ç¤ºåœ¨èŠå¤©ä¸­

---

## ğŸ› ï¸ æ³¨æ„äº‹é¡¹

### æ€§èƒ½ä¼˜åŒ–
- ä½¿ç”¨`useCallback`åŒ…è£…äº‹ä»¶å¤„ç†å‡½æ•°
- é¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
- åˆç†ä½¿ç”¨`useEffect`ä¾èµ–æ•°ç»„

### ç±»å‹å®‰å…¨
- æ‰€æœ‰äº‹ä»¶éƒ½æœ‰æ˜ç¡®çš„ç±»å‹å®šä¹‰
- ä½¿ç”¨`as const`è¿›è¡Œç±»å‹æ–­è¨€
- é¿å…`any`ç±»å‹çš„è¿‡åº¦ä½¿ç”¨

### é”™è¯¯å¤„ç†
- æ‰€æœ‰APIè°ƒç”¨éƒ½æœ‰try-catchå—
- é”™è¯¯æ¶ˆæ¯ä¼šæ˜¾ç¤ºåœ¨èŠå¤©ç•Œé¢
- æä¾›ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º

### ç”¨æˆ·ä½“éªŒ
- æ‰“å­—æ•ˆæœè®©ç”¨æˆ·çŸ¥é“AIæ­£åœ¨æ€è€ƒ
- ç¦ç”¨çŠ¶æ€é˜²æ­¢é‡å¤è¯·æ±‚
- å®æ—¶çŠ¶æ€æ›´æ–°ï¼ˆæ‰“å­—ä¸­ã€åŠ è½½ä¸­ç­‰ï¼‰

---

## ğŸ“Š æ–‡ä»¶ç»“æ„

```
src/sidepanel/
â”œâ”€â”€ sidebarPanel.tsx          # ä¸»ä¾§è¾¹æ ç»„ä»¶
â”œâ”€â”€ SettingsPage.tsx           # è®¾ç½®é¡µé¢ç»„ä»¶ï¼ˆæœªå®ç°ï¼‰
â”œâ”€â”€ components/                 # ä¾§è¾¹æ ç›¸å…³ç»„ä»¶ï¼ˆå¾…åˆ›å»ºï¼‰
```

---

## âœ… å®ŒæˆçŠ¶æ€

- âœ… èŠå¤©ç•Œé¢ï¼šå®Œæ•´å®ç°ï¼Œæ”¯æŒå†å²æ¶ˆæ¯æ˜¾ç¤º
- âœ… æ¶ˆæ¯ç³»ç»Ÿï¼šç”¨æˆ·/AIæ¶ˆæ¯åŒºåˆ†æ˜¾ç¤º
- âœ… è®¾ç½®é›†æˆï¼šå¯åˆ‡æ¢åˆ°è®¾ç½®é¡µé¢ï¼ˆè®¾ç½®é¡µé¢å¾…å®Œå–„ï¼‰
- âœ… æˆªå›¾é›†æˆï¼šå®Œæ•´çš„æˆªå›¾åŠŸèƒ½é›†æˆ
- âœ… APIæ”¯æŒï¼šOpenAIã€Anthropicã€Custom APIå®Œæ•´æ”¯æŒ
- âœ…  ç±»å‹å®‰å…¨ï¼šTypeScriptç±»å‹å®‰å…¨

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

1. **æ™ºèƒ½èŠå¤©ç³»ç»Ÿ**
   - æ”¯æŒå†å²å¯¹è¯
   - å®æ—¶æ‰“å­—æ•ˆæœ
   - é”™è¯¯å¤„ç†å’Œæ˜¾ç¤º
   - ç”¨æˆ·è¾“å…¥å’ŒAIå“åº”åˆ†ç¦»

2. **å¤šæ¨¡æ€ä¸Šä¸‹æ–‡**
   - é€‰ä¸­æ–‡æœ¬ä¸Šä¸‹æ–‡
   - æˆªå›¾ä¸Šä¸‹æ–‡
   - è‡ªåŠ¨ä¸Šä¸‹æ–‡æ„å»ºå’Œä¼ é€’

3. **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
   - MD3è®¾è®¡ç³»ç»Ÿåº”ç”¨
   - æµç•…çš„åŠ¨ç”»å’Œè¿‡æ¸¡
   - æ— éšœç¢å‹å¥½

---

**ä¸‹ä¸€æ­¥**:
1. ä¸ºSettingsPage.tsxåˆ›å»ºè¯¦ç»†æ–‡æ¡£
2. åˆ›å»ºå…¶ä»–ç»„ä»¶çš„æ–‡æ¡£ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
3. æµ‹è¯•æ‰€æœ‰Phase 0-3çš„åŠŸèƒ½
4. è¿›å…¥Phase 4å¼€å‘

---

**æ³¨æ„äº‹é¡¹**ï¼š
- å½“å‰ä»£ç ä½¿ç”¨äº†ä¸€äº›`as const`ç±»å‹æ–­è¨€æ¥ç¡®ä¿ç±»å‹å®‰å…¨
- æˆªå›¾æ¨¡å¼éœ€è¦å®Œå–„UIä¼˜åŒ–
- å»ºè®®å®ç°çœŸæ­£çš„Markdownæ¸²æŸ“å™¨æ¥æ”¯æŒæ ¼å¼åŒ–å†…å®¹